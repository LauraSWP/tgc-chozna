(()=>{var e={};e.id=387,e.ids=[387],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},3910:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>o}),r(7334),r(3596),r(5866),r(2029);var s=r(3191),a=r(8716),n=r(7922),i=r.n(n),l=r(5231),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);r.d(t,c);let o=["",{children:["(app)",{children:["admin",{children:["users",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,7334)),"C:\\Users\\bkgum\\OneDrive\\Documents\\PythonScripts\\TGC\\tgc-chozna\\src\\app\\(app)\\admin\\users\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,3596)),"C:\\Users\\bkgum\\OneDrive\\Documents\\PythonScripts\\TGC\\tgc-chozna\\src\\app\\(app)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,2029)),"C:\\Users\\bkgum\\OneDrive\\Documents\\PythonScripts\\TGC\\tgc-chozna\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\bkgum\\OneDrive\\Documents\\PythonScripts\\TGC\\tgc-chozna\\src\\app\\(app)\\admin\\users\\page.tsx"],u="/(app)/admin/users/page",p={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/(app)/admin/users/page",pathname:"/admin/users",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},5874:(e,t,r)=>{Promise.resolve().then(r.bind(r,5936))},5936:(e,t,r)=>{"use strict";r.d(t,{default:()=>o});var s=r(326),a=r(7577),n=r(1664),i=r(9752),l=r(1632),c=r(1223);let o=({initialUsers:e})=>{let[t,r]=(0,a.useState)(e),[o,d]=(0,a.useState)(""),[u,p]=(0,a.useState)("all"),[m,x]=(0,a.useState)(!0),[f,h]=(0,a.useState)(null),g=(0,a.useMemo)(()=>t.filter(e=>{let t=e.username?.toLowerCase().includes(o.toLowerCase())||e.id.toLowerCase().includes(o.toLowerCase()),r="all"===u||e.role===u,s=m||!e.username?.startsWith("Guest_");return t&&r&&s}),[t,o,u,m]),y=async(e,t)=>{try{let{error:s}=await l.OQ.from("profiles").update({role:t}).eq("id",e);if(s)throw s;r(r=>r.map(r=>r.id===e?{...r,role:t}:r))}catch(e){console.error("Error updating user role:",e),alert("Failed to update user role")}},j=async(e,s,a)=>{try{let{data:n}=await l.OQ.from("user_currencies").select("*").eq("user_id",e).single();if(n){let{error:t}=await l.OQ.from("user_currencies").update({coins:n.coins+s,gems:n.gems+a}).eq("user_id",e);if(t)throw t;await l.OQ.from("transactions").insert({user_id:e,type:"admin_grant",amount_coins:s,amount_gems:a,description:`Admin granted ${s} coins and ${a} gems`})}else await l.OQ.from("user_currencies").insert({user_id:e,coins:1e3+s,gems:0+a});r(t=>t.map(t=>t.id===e?{...t,user_currencies:{coins:(t.user_currencies?.coins||1e3)+s,gems:(t.user_currencies?.gems||0)+a}}:t)),alert(`Successfully gave ${s} coins and ${a} gems to ${t.find(t=>t.id===e)?.username}`)}catch(e){console.error("Error giving currency:",e),alert("Failed to give currency")}},v=(e,t)=>{let r=prompt(`How many coins to give to ${t}?`,"100"),s=prompt(`How many gems to give to ${t}?`,"0");if(null!==r&&null!==s){let t=parseInt(r)||0,a=parseInt(s)||0;(0!==t||0!==a)&&j(e,t,a)}};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(i.Zb,{children:[s.jsx(i.Ol,{children:s.jsx(i.ll,{children:"Filters"})}),s.jsx(i.aY,{children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Search"}),s.jsx("input",{type:"text",value:o,onChange:e=>d(e.target.value),className:"w-full border rounded-md px-3 py-2",placeholder:"Search users..."})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Role"}),(0,s.jsxs)("select",{value:u,onChange:e=>p(e.target.value),className:"w-full border rounded-md px-3 py-2",children:[s.jsx("option",{value:"all",children:"All Roles"}),s.jsx("option",{value:"player",children:"Players"}),s.jsx("option",{value:"admin",children:"Admins"}),s.jsx("option",{value:"moderator",children:"Moderators"})]})]}),s.jsx("div",{className:"flex items-end",children:(0,s.jsxs)("label",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",checked:m,onChange:e=>x(e.target.checked),className:"rounded"}),s.jsx("span",{className:"text-sm",children:"Show guest users"})]})})]})})]}),s.jsx("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["Showing ",g.length," of ",t.length," users"]})}),s.jsx(i.Zb,{children:s.jsx(i.aY,{className:"p-0",children:s.jsx("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,s.jsxs)("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Currency"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cards"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),s.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:g.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:s.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:s.jsx("span",{className:"text-sm font-medium text-gray-700",children:e.username?.charAt(0).toUpperCase()||"?"})})}),(0,s.jsxs)("div",{className:"ml-4",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.username}),(0,s.jsxs)("div",{className:"text-sm text-gray-500 font-mono",children:[e.id.slice(0,8),"..."]})]})]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("select",{value:e.role,onChange:t=>y(e.id,t.target.value),className:"text-sm border rounded px-2 py-1",children:[s.jsx("option",{value:"player",children:"Player"}),s.jsx("option",{value:"moderator",children:"Moderator"}),s.jsx("option",{value:"admin",children:"Admin"})]})}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:[(0,s.jsxs)("div",{children:["\uD83E\uDE99 ",(0,c.uf)(e.user_currencies?.coins||0)]}),(0,s.jsxs)("div",{children:["\uD83D\uDC8E ",(0,c.uf)(e.user_currencies?.gems||0)]})]}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:(0,c.uf)(e.user_cards?.[0]?.count||0)}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString()}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:s.jsx(n.z,{size:"sm",variant:"outline",onClick:()=>v(e.id,e.username),children:"Give Currency"})})]},e.id))})]})})})}),0===g.length&&s.jsx(i.Zb,{children:(0,s.jsxs)(i.aY,{className:"py-12 text-center",children:[s.jsx("p",{className:"text-gray-500 mb-4",children:"No users found matching your filters"}),s.jsx(n.z,{onClick:()=>{d(""),p("all"),x(!0)},variant:"outline",children:"Clear Filters"})]})})]})}},8585:(e,t,r)=>{"use strict";var s=r(1085);r.o(s,"redirect")&&r.d(t,{redirect:function(){return s.redirect}})},1085:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{ReadonlyURLSearchParams:function(){return i},RedirectType:function(){return s.RedirectType},notFound:function(){return a.notFound},permanentRedirect:function(){return s.permanentRedirect},redirect:function(){return s.redirect}});let s=r(3953),a=r(6399);class n extends Error{constructor(){super("Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams")}}class i extends URLSearchParams{append(){throw new n}delete(){throw new n}set(){throw new n}sort(){throw new n}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6399:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{isNotFoundError:function(){return a},notFound:function(){return s}});let r="NEXT_NOT_FOUND";function s(){let e=Error(r);throw e.digest=r,e}function a(e){return"object"==typeof e&&null!==e&&"digest"in e&&e.digest===r}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},8586:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RedirectStatusCode",{enumerable:!0,get:function(){return r}}),function(e){e[e.SeeOther=303]="SeeOther",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect"}(r||(r={})),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},3953:(e,t,r)=>{"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{RedirectType:function(){return s},getRedirectError:function(){return c},getRedirectStatusCodeFromError:function(){return x},getRedirectTypeFromError:function(){return m},getURLFromRedirectError:function(){return p},isRedirectError:function(){return u},permanentRedirect:function(){return d},redirect:function(){return o}});let a=r(4580),n=r(2934),i=r(8586),l="NEXT_REDIRECT";function c(e,t,r){void 0===r&&(r=i.RedirectStatusCode.TemporaryRedirect);let s=Error(l);s.digest=l+";"+t+";"+e+";"+r+";";let n=a.requestAsyncStorage.getStore();return n&&(s.mutableCookies=n.mutableCookies),s}function o(e,t){void 0===t&&(t="replace");let r=n.actionAsyncStorage.getStore();throw c(e,t,(null==r?void 0:r.isAction)?i.RedirectStatusCode.SeeOther:i.RedirectStatusCode.TemporaryRedirect)}function d(e,t){void 0===t&&(t="replace");let r=n.actionAsyncStorage.getStore();throw c(e,t,(null==r?void 0:r.isAction)?i.RedirectStatusCode.SeeOther:i.RedirectStatusCode.PermanentRedirect)}function u(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let[t,r,s,a]=e.digest.split(";",4),n=Number(a);return t===l&&("replace"===r||"push"===r)&&"string"==typeof s&&!isNaN(n)&&n in i.RedirectStatusCode}function p(e){return u(e)?e.digest.split(";",3)[2]:null}function m(e){if(!u(e))throw Error("Not a redirect error");return e.digest.split(";",2)[1]}function x(e){if(!u(e))throw Error("Not a redirect error");return Number(e.digest.split(";",4)[3])}(function(e){e.push="push",e.replace="replace"})(s||(s={})),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},7334:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(9510),a=r(3804),n=r(5456),i=r(8585);let l=(0,r(8570).createProxy)(String.raw`C:\Users\bkgum\OneDrive\Documents\PythonScripts\TGC\tgc-chozna\src\components\admin\UserManagementClient.tsx#default`);async function c(){let e=await (0,n.PR)();e||(0,i.redirect)("/login");let{data:t}=await (0,n.et)(e.id);t?.role!=="admin"&&(0,i.redirect)("/dashboard");let r=await (0,n.eI)(),{data:c}=await r.from("profiles").select(`
      *,
      user_currencies(coins, gems),
      user_cards(count)
    `).order("created_at",{ascending:!1});return(0,s.jsxs)("div",{className:"space-y-6",children:[s.jsx("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:"User Management"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Monitor and manage user accounts"})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx(a.Zb,{children:(0,s.jsxs)(a.aY,{className:"p-6",children:[s.jsx("div",{className:"text-2xl font-bold",children:c?.length||0}),s.jsx("p",{className:"text-sm text-gray-600",children:"Total Users"})]})}),s.jsx(a.Zb,{children:(0,s.jsxs)(a.aY,{className:"p-6",children:[s.jsx("div",{className:"text-2xl font-bold",children:c?.filter(e=>"admin"===e.role).length||0}),s.jsx("p",{className:"text-sm text-gray-600",children:"Admins"})]})}),s.jsx(a.Zb,{children:(0,s.jsxs)(a.aY,{className:"p-6",children:[s.jsx("div",{className:"text-2xl font-bold",children:c?.filter(e=>e.username?.startsWith("Guest_")).length||0}),s.jsx("p",{className:"text-sm text-gray-600",children:"Guest Users"})]})}),s.jsx(a.Zb,{children:(0,s.jsxs)(a.aY,{className:"p-6",children:[s.jsx("div",{className:"text-2xl font-bold",children:c?.filter(e=>e.created_at&&new Date(e.created_at)>new Date(Date.now()-7*24*60*60*1e3)).length||0}),s.jsx("p",{className:"text-sm text-gray-600",children:"New This Week"})]})})]}),s.jsx(l,{initialUsers:c||[]})]})}},3804:(e,t,r)=>{"use strict";r.d(t,{Ol:()=>l,SZ:()=>o,Zb:()=>i,aY:()=>d,ll:()=>c});var s=r(9510),a=r(1159),n=r(644);let i=a.forwardRef(({className:e,...t},r)=>s.jsx("div",{ref:r,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));i.displayName="Card";let l=a.forwardRef(({className:e,...t},r)=>s.jsx("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",e),...t}));l.displayName="CardHeader";let c=a.forwardRef(({className:e,...t},r)=>s.jsx("h3",{ref:r,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t}));c.displayName="CardTitle";let o=a.forwardRef(({className:e,...t},r)=>s.jsx("p",{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",e),...t}));o.displayName="CardDescription";let d=a.forwardRef(({className:e,...t},r)=>s.jsx("div",{ref:r,className:(0,n.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent",a.forwardRef(({className:e,...t},r)=>s.jsx("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,305,254,404,835,314],()=>r(3910));module.exports=s})();