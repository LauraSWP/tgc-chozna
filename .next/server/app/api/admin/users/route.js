"use strict";(()=>{var e={};e.id=628,e.ids=[628],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},1631:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>w,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>x,staticGenerationAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{GET:()=>d,PUT:()=>p,dynamic:()=>c});var n=t(9303),a=t(8716),o=t(670),i=t(7070),u=t(5456);let c="force-dynamic";async function d(e){try{let e=await (0,u.PR)();if(!e)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{data:r}=await (0,u.et)(e.id);if(r?.role!=="admin")return i.NextResponse.json({error:"Forbidden"},{status:403});let t=await (0,u.eI)(),{data:s,error:n}=await t.from("profiles").select(`
        *,
        user_currencies(coins, gems),
        user_cards(count)
      `).order("created_at",{ascending:!1});if(n)throw n;return i.NextResponse.json({users:s})}catch(e){return console.error("Error fetching users:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e){try{let r=await (0,u.PR)();if(!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{data:t}=await (0,u.et)(r.id);if(t?.role!=="admin")return i.NextResponse.json({error:"Forbidden"},{status:403});let{userId:s,action:n,...a}=await e.json();if(!s||!n)return i.NextResponse.json({error:"User ID and action required"},{status:400});let o=await (0,u.eI)();switch(n){case"update_role":let{role:c}=a;if(!["player","admin","moderator"].includes(c))return i.NextResponse.json({error:"Invalid role"},{status:400});let{error:d}=await o.from("profiles").update({role:c}).eq("id",s);if(d)throw d;break;case"give_currency":let{coins:p=0,gems:l=0}=a,{data:m}=await o.from("user_currencies").select("*").eq("user_id",s).single();if(m){let{error:e}=await o.from("user_currencies").update({coins:m.coins+p,gems:m.gems+l}).eq("user_id",s);if(e)throw e}else{let{error:e}=await o.from("user_currencies").insert({user_id:s,coins:1e3+p,gems:0+l});if(e)throw e}await o.from("transactions").insert({user_id:s,type:"admin_grant",amount_coins:p,amount_gems:l,description:`Admin granted ${p} coins and ${l} gems`});break;case"give_cards":let{cardIds:f=[]}=a,x=f.map(e=>({owner:s,card_def_id:e,foil:!1})),{error:g}=await o.from("user_cards").insert(x);if(g)throw g;break;default:return i.NextResponse.json({error:"Invalid action"},{status:400})}return i.NextResponse.json({success:!0})}catch(e){return console.error("Error updating user:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let l=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/users/route",pathname:"/api/admin/users",filename:"route",bundlePath:"app/api/admin/users/route"},resolvedPagePath:"C:\\Users\\bkgum\\OneDrive\\Documents\\PythonScripts\\TGC\\tgc-chozna\\src\\app\\api\\admin\\users\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:x}=l,g="/api/admin/users/route";function w(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:f})}},5456:(e,r,t)=>{t.d(r,{PR:()=>o,eI:()=>a,et:()=>i});var s=t(6718),n=t(1615);async function a(){let e=(0,n.cookies)();return(0,s.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{get:r=>e.get(r)?.value}})}async function o(){let e=await a(),{data:{user:r}}=await e.auth.getUser();return r}async function i(e){let r=await a(),{data:t,error:s}=await r.from("profiles").select("*").eq("id",e).single();return{data:t,error:s}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,305,972],()=>t(1631));module.exports=s})();